# 상품목록 브랜드 아이디 기반 검색 추가 

## 쿼리

```sql
EXPLAIN
SELECT
    p.id,
    p.price,
    p.name,
    b.name,
    (SELECT COUNT(pl.id) FROM product_like pl WHERE pl.ref_product_id = p.id) AS like_count,
    p.released_at
FROM
    product p
LEFT JOIN
    brand b ON p.ref_brand_id = b.id
WHERE
    b.id = 1
ORDER BY p.price ASC
LIMIT
    5 OFFSET 0;
```

## 인덱스 가격에만 설정

### 쿼리 결과

```sql
+--------+-------+------------------+-------------------------------+------------+----------------------------+
| id     | price | name             | name                          | like_count | released_at                |
+--------+-------+------------------+-------------------------------+------------+----------------------------+
| 261409 |  5079 | ??? ??? #261409  | Juniper Pharmaceuticals, Inc. |          0 | 2025-07-28 00:00:00.000000 |
| 437561 | 11575 | ???? ?? #437561  | Juniper Pharmaceuticals, Inc. |          0 | 2025-04-22 00:00:00.000000 |
| 160167 | 17543 | ????? ?? #160167 | Juniper Pharmaceuticals, Inc. |          0 | 2024-11-27 00:00:00.000000 |
| 265829 | 31007 | ??? ?? #265829   | Juniper Pharmaceuticals, Inc. |          0 | 2025-06-10 00:00:00.000000 |
| 408782 | 47181 | ??? ?? #408782   | Juniper Pharmaceuticals, Inc. |          0 | 2025-03-04 00:00:00.000000 |
+--------+-------+------------------+-------------------------------+------------+----------------------------+
5 rows in set (0.02 sec)
```

### 쿼리 실행 계획

```sql
+----+--------------------+-------+------------+-------+-----------------------------+-----------------------------+---------+--------------+------+----------+----------------+
| id | select_type        | table | partitions | type  | possible_keys               | key                         | key_len | ref          | rows | filtered | Extra          |
+----+--------------------+-------+------------+-------+-----------------------------+-----------------------------+---------+--------------+------+----------+----------------+
|  1 | PRIMARY            | b     | NULL       | const | PRIMARY                     | PRIMARY                     | 8       | const        |    1 |   100.00 | Using filesort |
|  1 | PRIMARY            | p     | NULL       | ref   | FKrmtt319m6bje7x9emb2sg552o | FKrmtt319m6bje7x9emb2sg552o | 9       | const        | 1227 |   100.00 | NULL           |
|  2 | DEPENDENT SUBQUERY | pl    | NULL       | ref   | idx_ref_product_id          | idx_ref_product_id          | 8       | loopers.p.id |    1 |   100.00 | Using index    |
+----+--------------------+-------+------------+-------+-----------------------------+-----------------------------+---------+--------------+------+----------+----------------+
3 rows in set, 2 warnings (0.00 sec)

```


## 인덱스 가격 , 브랜드ID (단일 인덱스 각각)

### 쿼리 결과

```sql
+--------+-------+------------------+-------------------------------+------------+----------------------------+
| id     | price | name             | name                          | like_count | released_at                |
+--------+-------+------------------+-------------------------------+------------+----------------------------+
| 261409 |  5079 | ??? ??? #261409  | Juniper Pharmaceuticals, Inc. |          0 | 2025-07-28 00:00:00.000000 |
| 437561 | 11575 | ???? ?? #437561  | Juniper Pharmaceuticals, Inc. |          0 | 2025-04-22 00:00:00.000000 |
| 160167 | 17543 | ????? ?? #160167 | Juniper Pharmaceuticals, Inc. |          0 | 2024-11-27 00:00:00.000000 |
| 265829 | 31007 | ??? ?? #265829   | Juniper Pharmaceuticals, Inc. |          0 | 2025-06-10 00:00:00.000000 |
| 408782 | 47181 | ??? ?? #408782   | Juniper Pharmaceuticals, Inc. |          0 | 2025-03-04 00:00:00.000000 |
+--------+-------+------------------+-------------------------------+------------+----------------------------+
5 rows in set (0.01 sec)
```


### 실행 계획

```sql
+----+--------------------+-------+------------+-------+--------------------+--------------------+---------+--------------+------+----------+----------------+
| id | select_type        | table | partitions | type  | possible_keys      | key                | key_len | ref          | rows | filtered | Extra          |
+----+--------------------+-------+------------+-------+--------------------+--------------------+---------+--------------+------+----------+----------------+
|  1 | PRIMARY            | b     | NULL       | const | PRIMARY            | PRIMARY            | 8       | const        |    1 |   100.00 | Using filesort |
|  1 | PRIMARY            | p     | NULL       | ref   | idx_ref_brand_id   | idx_ref_brand_id   | 9       | const        | 1227 |   100.00 | NULL           |
|  2 | DEPENDENT SUBQUERY | pl    | NULL       | ref   | idx_ref_product_id | idx_ref_product_id | 8       | loopers.p.id |    1 |   100.00 | Using index    |
+----+--------------------+-------+------------+-------+--------------------+--------------------+---------+--------------+------+----------+----------------+
3 rows in set, 2 warnings (0.01 sec)

```

## 인덱스 가격 , 브랜드 ID (복합 인덱스)


### 쿼리 결과

```sql
+--------+-------+------------------+-------------------------------+------------+----------------------------+
| id     | price | name             | name                          | like_count | released_at                |
+--------+-------+------------------+-------------------------------+------------+----------------------------+
| 261409 |  5079 | ??? ??? #261409  | Juniper Pharmaceuticals, Inc. |          0 | 2025-07-28 00:00:00.000000 |
| 437561 | 11575 | ???? ?? #437561  | Juniper Pharmaceuticals, Inc. |          0 | 2025-04-22 00:00:00.000000 |
| 160167 | 17543 | ????? ?? #160167 | Juniper Pharmaceuticals, Inc. |          0 | 2024-11-27 00:00:00.000000 |
| 265829 | 31007 | ??? ?? #265829   | Juniper Pharmaceuticals, Inc. |          0 | 2025-06-10 00:00:00.000000 |
| 408782 | 47181 | ??? ?? #408782   | Juniper Pharmaceuticals, Inc. |          0 | 2025-03-04 00:00:00.000000 |
+--------+-------+------------------+-------------------------------+------------+----------------------------+
5 rows in set (0.01 sec)
```

### 실행 계획

```sql
+----+--------------------+-------+------------+-------+-----------------------------------------+------------------------+---------+--------------+------+----------+-------------+
| id | select_type        | table | partitions | type  | possible_keys                           | key                    | key_len | ref          | rows | filtered | Extra       |
+----+--------------------+-------+------------+-------+-----------------------------------------+------------------------+---------+--------------+------+----------+-------------+
|  1 | PRIMARY            | b     | NULL       | const | PRIMARY                                 | PRIMARY                | 8       | const        |    1 |   100.00 | NULL        |
|  1 | PRIMARY            | p     | NULL       | ref   | idx_ref_brand_id,idx_ref_brand_id_price | idx_ref_brand_id_price | 9       | const        | 1227 |   100.00 | NULL        |
|  2 | DEPENDENT SUBQUERY | pl    | NULL       | ref   | idx_ref_product_id                      | idx_ref_product_id     | 8       | loopers.p.id |    1 |   100.00 | Using index |
+----+--------------------+-------+------------+-------+-----------------------------------------+------------------------+---------+--------------+------+----------+-------------+
3 rows in set, 2 warnings (0.01 sec)
```